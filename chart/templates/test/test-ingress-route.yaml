{{ if .Values.env }}
{{ if eq .Values.env "test" }}
apiVersion: v1
kind: Pod
metadata:
  name: "{{ .Release.Name }}-route-test"
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: {{ .Release.Name }}-route-test
      image: "ubuntu:18.04"
      imagePullPolicy: {{ .Values.imagePullPolicy | quote }}
      command:
        - /bin/bash
        - -ec
      args:
        - apt-get update && apt-get install -y curl > /dev/null 2>&1 &&
          echo "10.0.0.10    test-app" >> /etc/hosts &&
          curl -f http://test-app/
  restartPolicy: Never
{{ end }}
{{ end }}
