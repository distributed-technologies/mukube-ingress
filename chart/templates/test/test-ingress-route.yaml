{{ if .Values.env }}
{{ if eq .Values.env "test" }}
apiVersion: v1
kind: Pod
metadata:
  name: "{{ .Release.Name }}-route-test"
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: {{ .Release.Name }}-route-test
      image: "ubuntu:18.04"
      imagePullPolicy: {{ .Values.imagePullPolicy | quote }}
      env:
        - name: CURL_IP
          value: 10.0.0.10
      command:
        - /bin/bash
        - -ec
        - |
          apt-get update && apt-get install -y curl > /dev/null 2>&1
          curl -f http://$CURL_IP/test
  restartPolicy: Never
{{ end }}
{{ end }}
